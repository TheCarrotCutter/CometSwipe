<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>jelly gon</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>
</head>
<body>
    <script>
        const config = {
            type: Phaser.AUTO,
            width: 600,
            height: 600,
            pixelArt: true,
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 0 },
                    debug: true
                }
            },
            scene: {
                preload: preload,
                create: create,
                update: update
            }
        };

        let player
        let graphics
        let imageGenerator
        let gameCanvas
        let mouseMoveX = 0;
        let mouseMoveY = 0;
        let basicEnemies
        let particle
        let circleParticle
        let playerEmitter
        let enemyEmitter
        
        const speed_basic = 5;
        
        const game = new Phaser.Game(config);
        
        function preload() {
          
        }

        function create() {

            let thisBefore = this;

            gameCanvas = game.canvas
            
            player = this.physics.add.sprite(300, 300);

            graphics = this.add.graphics();
            //graphics is actually used to draw the player AND every enemy
            
            basicEnemies = [
              {x: 200, y: 200},
              {x: 400, y: 400}
            ];
            
            basicEnemies.forEach((object) => {
              object.sprite = thisBefore.physics.add.sprite(object.x, object.y);
              
              object.trail = circleParticle.createEmitter({
              x: 0,
              y: 0,
              speed: 0,
              lifespan: 300,
              quantity: 1,
              alpha: {start: 0.75, end: 0},
              scale: {start: 1.5, end: 0.5}
            });
            
            })
            
            imageGenerator = this.add.graphics();
            
            //generating particle textures
            imageGenerator.fillStyle(0xffffff, 1)
            imageGenerator.fillCircle(10, 10, 10);
            imageGenerator.generateTexture('imageCircle', 20, 20);
            imageGenerator.clear();

            circleParticle = this.add.particles('imageCircle');

            playerEmitter = circleParticle.createEmitter({
              x: 0,
              y: 0,
              speed: 0,
              lifespan: 300,
              quantity: 1,
              alpha: {start: 0.75, end: 0},
              scale: {start: 1.5, end: 0.5}
            });
            
            playerEmitter.startFollow(player);
            
            playerEmitter.startFollow(player);


        }

        function update(time, delta) {
            graphics.clear();
            graphics.fillStyle(0xffffff, 1);
            graphics.fillCircle(player.x, player.y, 15);
            
            gameCanvas.requestPointerLock();

            player.x = player.x + mouseMoveX;
            player.y = player.y + mouseMoveY;

            if (mouseMoveX = 0) {
              player.velocity.x = 0;
            }
            if (mouseMoveY = 0) {
              player.velocity.y = 0;
            }

            basicEnemies.forEach((object) => {
              graphics.fillCircle(object.sprite.x, object.sprite.y, 15);
              
              this.physics.moveToObject(object.sprite, player, 100);
              
              enemyEmitter.emitParticle(1, object.sprite.x, object.sprite.y);
            });
            

        }

        document.addEventListener('mousemove', function(event) {
            mouseMoveX = event.movementX;
            mouseMoveY = event.movementY;
        });

    </script>
</body>
</html>
