<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Platformer Game</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>
</head>
<body>
    <script>
        // Pixelation Shader
        const pixelationShader = `
            precision mediump float;
            uniform float u_resolution;
            uniform sampler2D uMainSampler;
            varying vec2 outTexCoord;
            
            void main() {
                float pixelSize = 1.0 / u_resolution;
                vec2 pos = floor(outTexCoord / pixelSize) * pixelSize;
                gl_FragColor = texture2D(uMainSampler, pos);
            }
        `;

        // Phaser game configuration
        const config = {
            type: Phaser.AUTO,
            width: 650,
            height: 300,
            pixelArt: true,
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 700 },
                    debug: false
                }
            },
            scene: {
                preload: preload,
                create: create,
                update: update
            }
        };

        // Game instance
        const game = new Phaser.Game(config);

        let player;
        let platforms;
        let cursors;
        let pixelShader;

        function preload() {
            // No external assets are being loaded, we'll use basic shapes
        }

        function create() {
            // Create a simple sky background using a rectangle
            this.add.rectangle(400, 300, 1300, 700, 0x87CEEB);  // Sky Blue

            // Create static platforms using simple rectangles
            platforms = this.physics.add.staticGroup();
            platforms.create(400, 568, null).setDisplaySize(200, 32); // Platform 1
            platforms.create(600, 400, null).setDisplaySize(200, 32); // Platform 2
            platforms.create(50, 250, null).setDisplaySize(200, 32);  // Platform 3
            platforms.create(750, 220, null).setDisplaySize(200, 32); // Platform 4

            // Create player as a simple rectangle
            player = this.physics.add.sprite(100, 450, null);
            player.setDisplaySize(32, 32);  // Set the size of the player (width x height)
            player.setBounce(0);
            player.setCollideWorldBounds(true);

            // Collider for the player and the platforms
            this.physics.add.collider(player, platforms);

            // Set up basic controls
            cursors = this.input.keyboard.createCursorKeys();

            // Create the pixelation shader and apply it to the camera
            pixelShader = this.add.shader(pixelationShader, 0, 0, 1300, 600);

            // Apply shader to the camera (all objects rendered by the camera will be affected)
            this.cameras.main.setPostPipeline(pixelShader);

            console.log("Scene created successfully!");
        }

        function update(time, delta) {
            let playerVelocityX = player.body.velocity.x;
            let playerVelocityY = player.body.velocity.y;

            let velocityChange = 0.5 * delta;
            
            if (playerVelocityX > 0) {
                player.setVelocityX(playerVelocityX - velocityChange * 20)
            }
            if (playerVelocityX < 0) {
                player.setVelocityX(playerVelocityX + velocityChange * 20)
            }
            if (playerVelocityX < velocityChange * 20 && playerVelocityX > velocityChange * -20) {
                player.setVelocityX(0)
            }
            if (cursors.left.isDown && playerVelocityX >= -550) {
                player.setVelocityX(playerVelocityX - velocityChange * 50);
                if (playerVelocityX > 0) {
                    player.setVelocityX(0)
                }
            }
            if (cursors.right.isDown && playerVelocityX <= 550) {
                player.setVelocityX(playerVelocityX + velocityChange * 50);
                if (playerVelocityX < 0) {
                    player.setVelocityX(0)
                }
            }
            if (cursors.up.isDown && player.body.onFloor()) {
                player.setVelocityY(-450);
            }
            if (cursors.down.isDown) {
                player.setVelocityY(playerVelocityY + velocityChange * 100);
            }
        }
    </script>
</body>
</html>
