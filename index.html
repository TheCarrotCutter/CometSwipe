<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Platformer Game</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>
</head>
<body>
    <script>
        // Phaser game configuration
        const config = {
            type: Phaser.AUTO,
            width: 1300,
            height: 600,
            pixelArt: true,
            physics: {
                default: 'matter',
                matter: {
                    gravity: { y: 700 },
                    debug: false
                }
            },
            scene: {
                preload: preload,
                create: create,
                update: update
            }
        };

        // Game instance
        const game = new Phaser.Game(config);

        let player;
        let platforms;
        let cursors;
        let pixelShader;

        function preload() {
             var url;
                // Load the pixelation plugin
                url = 'https://raw.githubusercontent.com/rexrainbow/phaser3-rex-notes/master/dist/rexpixelationpipelineplugin.min.js';
                this.load.plugin('rexpixelationpipelineplugin', url, true);
        }

        function create() {

            var postFxPlugin = this.plugins.get('rexpixelationpipelineplugin');
            // Apply the pixelation effect to the camera
            this.cameraFilter = postFxPlugin.add(this.cameras.main);

            this.cameraFilter.pixelWidth = 5;
            this.cameraFilter.pixelHeight = 5;
            
            // Create a simple sky background using a rectangle
            this.add.rectangle(400, 300, 1300, 700, 0x87CEEB);  // Sky Blue

            // Create static platforms using simple rectangles
            platforms = this.physics.add.staticGroup();
            platforms.create(400, 568, null).setDisplaySize(200, 32); // Platform 1
            platforms.create(600, 400, null).setDisplaySize(200, 32); // Platform 2
            platforms.create(50, 250, null).setDisplaySize(200, 32);  // Platform 3
            platforms.create(750, 220, null).setDisplaySize(200, 32); // Platform 4

            // Create player as a simple rectangle
            player = this.physics.add.sprite(100, 450, null);
            player.setDisplaySize(32, 32);  // Set the size of the player (width x height)
            player.setBounce(0);
            player.setCollideWorldBounds(true);

            const player1 = this.matter.add.circle(200, 200, 20);
            const player2 = this.matter.add.circle(200, 200, 20);
            const player3 = this.matter.add.circle(200, 200, 20);
            const player4 = this.matter.add.circle(200, 200, 20);
            const player5 = this.matter.add.circle(200, 200, 20);
            const player6 = this.matter.add.circle(200, 200, 20);
            const player7 = this.matter.add.circle(200, 200, 20);
            const player8 = this.matter.add.circle(200, 200, 20);
            const player9 = this.matter.add.circle(200, 200, 20);
            const player10 = this.matter.add.circle(200, 200, 20);
            const player11 = this.matter.add.circle(200, 200, 20);
            const player12 = this.matter.add.circle(200, 200, 20);

            this.matter.add.constraint(player1, player2, 20, 0.5)
            this.matter.add.constraint(player2, player3, 20, 0.5)
            this.matter.add.constraint(player3, player4, 20, 0.5)
            this.matter.add.constraint(player4, playe5r, 20, 0.5)
            this.matter.add.constraint(player5, player6, 20, 0.5)
            this.matter.add.constraint(player6, player7, 20, 0.5)
            this.matter.add.constraint(player7, player8, 20, 0.5)
            this.matter.add.constraint(player8, player9, 20, 0.5)
            this.matter.add.constraint(player9, player10, 20, 0.5)
            this.matter.add.constraint(player10, player11, 20, 0.5)
            this.matter.add.constraint(player11, player12, 20, 0.5)
            this.matter.add.constraint(player12, player1, 20, 0.5)


            // Collider for the player and the platforms
            this.physics.add.collider(player, platforms);

            // Set up basic controls
            cursors = this.input.keyboard.createCursorKeys();

            // Create the pixelation shader and apply it to the camera
            //pixelShader = this.add.shader(pixelationShader, 0, 0, 1300, 600);

            // Apply shader to the camera (all objects rendered by the camera will be affected)
            //this.cameras.main.setPostPipeline(pixelShader);

            console.log("Scene created successfully!");
        }

        function update(time, delta) {
            let playerVelocityX = player.body.velocity.x;
            let playerVelocityY = player.body.velocity.y;

            let velocityChange = 0.5 * delta;
            
            if (playerVelocityX > 0) {
                player.setVelocityX(playerVelocityX - velocityChange * 20)
            }
            if (playerVelocityX < 0) {
                player.setVelocityX(playerVelocityX + velocityChange * 20)
            }
            if (playerVelocityX < velocityChange * 20 && playerVelocityX > velocityChange * -20) {
                player.setVelocityX(0)
            }
            if (cursors.left.isDown && playerVelocityX >= -550) {
                player.setVelocityX(playerVelocityX - velocityChange * 50);
                if (playerVelocityX > 0) {
                    player.setVelocityX(0)
                }
            }
            if (cursors.right.isDown && playerVelocityX <= 550) {
                player.setVelocityX(playerVelocityX + velocityChange * 50);
                if (playerVelocityX < 0) {
                    player.setVelocityX(0)
                }
            }
            if (cursors.up.isDown && player.body.onFloor()) {
                player.setVelocityY(-450);
            }
            if (cursors.down.isDown) {
                player.setVelocityY(playerVelocityY + velocityChange * 100);
            }
        }
    </script>
</body>
</html>
