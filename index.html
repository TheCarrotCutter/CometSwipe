<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Platformer Game</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>
</head>
<body>
    <script>
        // Pixelation Shader
        const pixelationShader = `
            precision mediump float;
            uniform float u_resolution;
            uniform sampler2D uMainSampler;
            varying vec2 outTexCoord;

            void main() {
                // Calculate the pixel size based on resolution
                float pixelSize = 1.0 / u_resolution;
                vec2 pos = floor(outTexCoord / pixelSize) * pixelSize;
                gl_FragColor = texture2D(uMainSampler, pos);
            }
        `;

        // Phaser game configuration
        const config = {
            type: Phaser.AUTO,
            width: 650,  // Lower resolution width (adjust this for more pixelation)
            height: 300, // Lower resolution height (adjust this for more pixelation)
            pixelArt: true,
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 700 },
                    debug: false
                }
            },
            scene: {
                preload: preload,
                create: create,
                update: update
            }
        };

        // Game instance
        const game = new Phaser.Game(config);

        let player;
        let platforms;
        let cursors;
        let pixelShader;

        function preload() {
            // No external assets are being loaded for now
        }

        function create() {
            // Create a simple sky background using a rectangle
            this.add.rectangle(200, 150, 400, 300, 0x87CEEB);  // Sky Blue

            // Create static platforms using simple rectangles (player and platform display size added)
            platforms = this.physics.add.staticGroup();
            platforms.create(200, 250, null).setDisplaySize(200, 32); // Platform 1
            platforms.create(300, 200, null).setDisplaySize(200, 32); // Platform 2
            platforms.create(50, 150, null).setDisplaySize(200, 32);  // Platform 3
            platforms.create(350, 120, null).setDisplaySize(200, 32); // Platform 4

            // Create player as a simple rectangle
            player = this.physics.add.sprite(100, 200, null);
            player.setDisplaySize(32, 32);  // Set the size of the player (width x height)
            player.setBounce(0);
            player.setCollideWorldBounds(true);

            // Collider for the player and the platforms
            this.physics.add.collider(player, platforms);

            // Set up basic controls
            cursors = this.input.keyboard.createCursorKeys();

            // Create the pixelation shader and apply it to the camera
            this.cameras.main.setPostPipeline(pixelationShader);

            // Update the shader's resolution uniform to match the new camera size
            let width = this.cameras.main.width;
            let height = this.cameras.main.height;
            let resolution = Math.min(width, height); // Use the smallest dimension to maintain aspect ratio

            this.cameras.main.postPipeline.setUniform('u_resolution', resolution);
        }

        function update(time, delta) {
            let playerVelocityX = player.body.velocity.x;
            let playerVelocityY = player.body.velocity.y;

            let velocityChange = 0.5 * delta;
            
            if (playerVelocityX > 0) {
                player.setVelocityX(playerVelocityX - velocityChange * 20);
            }
            if (playerVelocityX < 0) {
                player.setVelocityX(playerVelocityX + velocityChange * 20);
            }
            if (playerVelocityX < velocityChange * 20 && playerVelocityX > velocityChange * -20) {
                player.setVelocityX(0);
            }
            if (cursors.left.isDown && playerVelocityX >= -550) {
                player.setVelocityX(playerVelocityX - velocityChange * 50);
                if (playerVelocityX > 0) {
                    player.setVelocityX(0);
                }
            }
            if (cursors.right.isDown && playerVelocityX <= 550) {
                player.setVelocityX(playerVelocityX + velocityChange * 50);
                if (playerVelocityX < 0) {
                    player.setVelocityX(0);
                }
            }
            if (cursors.up.isDown && player.body.onFloor()) {
                player.setVelocityY(-450);
            }
            if (cursors.down.isDown) {
                player.setVelocityY(playerVelocityY + velocityChange * 100);
            }
        }
    </script>
</body>
</html>
